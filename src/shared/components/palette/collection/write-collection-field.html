<div class="form-group" [id]="id()">

  <div class="panel panel-border-wide">

    <h2 class="heading-h2">
      {{caseField | ccdFieldLabel}}
    </h2>
    <ng-container *ngIf="!isNotAuthorisedToCreate()">
      <button class="button" type="button" (click)="addItem(true)">Add new</button>
    </ng-container>
    
    <h2 class="heading-h2 error-spacing">
      <span *ngIf="caseField.hint_text" class="form-hint">{{caseField.hint_text}}</span>
      <span *ngIf="formArray.errors" class="error-message">{{formArray.errors | ccdFirstError}}</span>
    </h2>

    <div class="form-group" *ngIf="caseField.value && caseField.value.length">

      <div class="form-group" *ngFor="let item of caseField.value; let i = index" #collectionItem>
        <div class="collection-title">
          <div class="float-left">
            <label [for]="buildIdPrefix(i) + i"><h3 class="heading-h3">{{itemLabel(i)}}</h3></label>
          </div>
          <div class="float-right">
              <ng-container *ngIf="!isNotAuthorisedToDelete(i)">
                <button class="button button-secondary" type="button" (click)="openModal(i)"
                    attr.aria-label="Remove {{ itemLabel(i) }}">Remove</button>
              </ng-container>
          </div>
        </div>
        <ccd-field-write [caseField]="buildCaseField(item, i)"
                         [caseFields]="caseFields"
                         [formGroup]="formGroup"
                         [registerControl]="buildControlRegistrer(item.id, i)"
                         [idPrefix]="buildIdPrefix(i)"
                         *ngIf="!isNotAuthorisedToUpdate(i)">
        </ccd-field-write>
        <ccd-field-read [caseField]="buildCaseField(item, i)"
                        [caseFields]="caseFields"
                        [formGroup]="formGroup"
                        [context]="context"
                        *ngIf="isNotAuthorisedToUpdate(i)">
        </ccd-field-read>
      </div>

    </div>
    <ng-container *ngIf="!isNotAuthorisedToCreate()">
      <button class="button" type="button" (click)="addItem()" [disabled]="isNotAuthorisedToCreate()" *ngIf="caseField.value && caseField.value.length">Add new</button>
    </ng-container>
  </div>

</div>
